<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SSH Terminal</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
<script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
<script src="servers.js"></script>
<style>
#terminal { width: 100%; height: 80vh; }
</style>
</head>
<body>
<div id="server-buttons"></div>
<label>Host: <input id="host" /></label>
<label>User: <input id="user" /></label>
<label>Password: <input id="password" type="password" /></label>
<label>Port: <input id="port" value="22" /></label>
<button id="connect">Connect</button>
<div id="terminal"></div>
<script>
const term = new Terminal();
term.open(document.getElementById('terminal'));
let ws;

function connect({ host, user, password, port }) {
  const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
  const hostname = window.location.hostname.includes(':')
    ? `[${window.location.hostname}]`
    : window.location.hostname;
  ws = new WebSocket(`${protocol}://${hostname}:8098/`);
  ws.onopen = () => {
    ws.send(JSON.stringify({ host, user, password, port }));
  };
  ws.onmessage = (ev) => term.write(ev.data);
  ws.onclose = () => { term.write('\r\nConnection closed\r\n'); ws = null; };
}

term.onData(data => ws && ws.send(data));

document.getElementById('connect').onclick = () => {
  connect({
    host: document.getElementById('host').value,
    user: document.getElementById('user').value,
    password: document.getElementById('password').value,
    port: parseInt(document.getElementById('port').value, 10) || 22,
  });
};

if (window.SERVER_LIST && Array.isArray(window.SERVER_LIST)) {
  const container = document.getElementById('server-buttons');
  window.SERVER_LIST.forEach((srv) => {
    const btn = document.createElement('button');
    btn.textContent = srv.name || srv.host;
    btn.onclick = () => connect({
      host: srv.host,
      user: srv.username,
      password: srv.password || '',
      port: srv.port || 22,
    });
    container.appendChild(btn);
  });
}
</script>
</body>
</html>
